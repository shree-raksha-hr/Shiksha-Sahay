<div class="container my-4">
    <div class="row justify-content-center">
      <div class="col-md-8">
        <div class="card chat-container">
          <div class="card-header bg-primary text-white">
            <h5 class="mb-0">
              <i class="fas fa-robot me-2"></i>AI Doubt Support
            </h5>
            <small>Ask any question and get instant help!</small>
          </div>
          <div class="card-body p-0">
            <div id="chatMessages" class="chat-messages">
              <div class="message ai-message">
                <div class="message-content">
                  <strong>AI Assistant:</strong> Hello! I'm here to help you with your doubts. Ask me any question about your studies and I'll do my best to explain it clearly.
                </div>
                <div class="message-time">Just now</div>
              </div>
            </div>
          </div>
          <div class="card-footer">
            <form id="chatForm" class="d-flex gap-2">
              <input type="text" id="messageInput" class="form-control" placeholder="Type your question here..." required>
              <button type="submit" class="btn btn-primary" id="sendButton">
                <i class="fas fa-paper-plane"></i>
              </button>
            </form>
          </div>
        </div>
  
        <div class="card mt-3">
          <div class="card-body">
            <h6>Sample Questions:</h6>
            <div class="d-flex flex-wrap gap-2">
              <button class="btn btn-sm btn-outline-primary sample-question" data-question="Explain the Pythagorean theorem">Pythagorean theorem</button>
              <button class="btn btn-sm btn-outline-primary sample-question" data-question="What is photosynthesis?">Photosynthesis</button>
              <button class="btn btn-sm btn-outline-primary sample-question" data-question="How do I solve quadratic equations?">Quadratic equations</button>
              <button class="btn btn-sm btn-outline-primary sample-question" data-question="What are the parts of speech in English?">Parts of speech</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <style>
  .chat-container {
    height: 600px;
    display: flex;
    flex-direction: column;
  }
  
  .chat-messages {
    height: 500px;
    overflow-y: auto;
    padding: 1rem;
    background-color: #f8f9fa;
  }
  
  .message {
    margin-bottom: 1rem;
    max-width: 80%;
  }
  
  .user-message {
    margin-left: auto;
  }
  
  .user-message .message-content {
    background-color: #007bff;
    color: white;
    padding: 0.75rem 1rem;
    border-radius: 1rem 1rem 0.25rem 1rem;
    text-align: right;
  }
  
  .ai-message .message-content {
    background-color: white;
    border: 1px solid #dee2e6;
    padding: 0.75rem 1rem;
    border-radius: 1rem 1rem 1rem 0.25rem;
  }
  
  .message-time {
    font-size: 0.75rem;
    color: #6c757d;
    margin-top: 0.25rem;
    text-align: right;
  }
  
  .ai-message .message-time {
    text-align: left;
  }
  
  .loading-message {
    display: none;
  }
  
  .loading-message.show {
    display: block;
  }
  
  .loading-dots {
    display: inline-block;
    font-style: italic;
    color: #555;
  }
  
  .loading-dots::after {
    content: '';
    animation: dots 1.2s steps(4, end) infinite;
  }
  
  @keyframes dots {
    0%, 20% { content: ''; }
    40% { content: '.'; }
    60% { content: '..'; }
    80%, 100% { content: '...'; }
  }
  </style>
  
  <script>
  const chatForm = document.getElementById('chatForm');
  const messageInput = document.getElementById('messageInput');
  const chatMessages = document.getElementById('chatMessages');
  const sendButton = document.getElementById('sendButton');
  const sampleQuestions = document.querySelectorAll('.sample-question');
  
  // Handle sample question clicks
  sampleQuestions.forEach(button => {
    button.addEventListener('click', () => {
      messageInput.value = button.dataset.question;
      messageInput.focus();
    });
  });
  
  // Handle form submission
  chatForm.addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const message = messageInput.value.trim();
    if (!message) return;
  
    // Show user message
    addMessage(message, 'user');
    messageInput.value = '';
    
    // Show loading message
    const loadingMessage = addLoadingMessage();
  
    // Disable send button
    sendButton.disabled = true;
    sendButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
  
    try {
      const response = await fetch('/chat/send', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ message })
      });
  
      const data = await response.json();
      loadingMessage.remove();
  
      if (data.success && data.aiResponse) {
        addMessage(data.aiResponse, 'ai');
      } else {
        addMessage('Sorry, I encountered an error. Please try again.', 'ai');
      }
    } catch (err) {
      console.error('Chat error:', err.stack);
      loadingMessage.remove();
      addMessage('Sorry, something went wrong while contacting the AI.', 'ai');
    } finally {
      sendButton.disabled = false;
      sendButton.innerHTML = '<i class="fas fa-paper-plane"></i>';
      messageInput.focus();
    }
  });
  
  // Append message to chat
  function addMessage(content, type) {
    const messageDiv = document.createElement('div');
    messageDiv.className = `message ${type}-message`;
  
    const time = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
  
    messageDiv.innerHTML = `
      <div class="message-content">
        ${type === 'user' ? content : `<strong>AI Assistant:</strong> ${content}`}
      </div>
      <div class="message-time">${time}</div>
    `;
  
    chatMessages.appendChild(messageDiv);
    chatMessages.scrollTop = chatMessages.scrollHeight;
  }
  
  // Add animated loading dots
  function addLoadingMessage() {
    const loadingDiv = document.createElement('div');
    loadingDiv.className = 'message ai-message loading-message show';
  
    loadingDiv.innerHTML = `
      <div class="message-content">
        <strong>AI Assistant:</strong> <span class="loading-dots">Thinking</span>
      </div>
    `;
  
    chatMessages.appendChild(loadingDiv);
    chatMessages.scrollTop = chatMessages.scrollHeight;
  
    return loadingDiv;
  }
  
  // Auto focus
  messageInput.focus();
  </script>
  